<%=stylesheet_link_tag 'student' %>
<div class="innerLR">
  <h3 class="aes-color"><i class="fa fa-search"></i>&nbsp;<%= t('search_mentor.title_search_mentor') %></h3>

  <div class="row">
    <div class="widget"> ‌ ‌
      <div class="widget-body">
        <div class="search-form">
            <%= form_tag search_search_mentor_basic_path, id: 'search_mentor_form', role: 'form', method: :get do %>
                <% if flash.now[:error] %>
                    <div id="div_msg_error" class="msg_error">
                      <ul>
                        <li><%= flash.now[:error] %></li>
                      </ul>
                    </div>
                <% end %>
                  <div class="input-group">
                    <%= text_field_tag "keyword", params[:keyword], placeholder: t('search_mentor.placeholder_keyword'), class: "form-control search_all", maxlength:2000 %>
                    <div class="input-group-btn"><button class="btn btn-primary rounded-none" id="searchButton"><i class="fa fa-search"></i></button></div>
                    <div id="group_advance" class="input-group-btn"><button id="advsearchButton" class="btn btn-default" type="button"><%= t('button.btn_advance') %></button></div>
                  </div>
            <% end %>
            </div>
      </div>
    </div>
  </div>

  <div id="result">
    <%= render partial: "search/search_mentor_result" %>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" style="overflow: auto;" id="Search_mentor_Modal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="updateModalLabel"><%= t('search_mentor.title_search_mentor_advance') %></h4>
      </div>
      <div id="Search_mentor_Content" class="modal-body">
        <%= render 'search/mentor_advance' %>
      </div>
      <div style="clear: both"></div>
      <div class="modal-footer">
        <button id="btnSearchMentorAdvance" type="button" class="btn btn-primary"><%= t('search_mentor.btn_search')%></button>
        <!--<button id="btnCancelSearchMentorAdvance" type="button" class="btn btn-default" data-dismiss="modal"><%= t('button.btn_cancel')%></button>-->
        <button id="btnResetSearchMentorAdvance" type="button" class="btn btn-default"><%= t('search_mentor.btn_reset')%></button>
      </div>
    </div>
  </div>
</div>

<script>

    $(document).ready(function () {
        $('#Search_mentor_Modal').on('shown.bs.modal', function() {
            $('#first_name').focus();
        })

        $("#search_mentor_form").validate({
            onfocusout: false,
            onkeyup: false,
            rules: {
                "keyword": { maxlength: {
                    param: 200,
                    depends:function(){
                        var text = $.trim($(this).val());
                        text=text.replace(/\s+/g, ' ');
                        $(this).val(text);
                        return true;
                    }
                }}
            },
            messages: {
                "keyword": {maxlength :I18n.t('js.validate.msg_maxlength')}
            },
            errorPlacement: function (error, element) {
                error.insertAfter(element.parent());
            },
            submitHandler: function (form) {
                $('#search_mentor_form').find('input:text').each(function () {
                    $(this).val($.trim($(this).val()));
                });
//                form.submit();
            },
            invalidHandler: function (form, validator) {
                $('#div_msg_error').text('');

                var errors = validator.numberOfInvalids();
                if (errors) {
                    validator.errorList[0].element.focus();
                }
            }
        });


//        $("#keyword").focus(function() {
//            $("#group_advance").fadeOut("medium");
//        });
//        $("#keyword").blur(function() {
//            $("#group_advance").fadeIn("medium");
//        });
        $("#advsearchButton").click(function(e){
            e.preventDefault();
            $("#Search_mentor_Modal").modal();
        });

        $("#searchButton").click(function(e){
            e.preventDefault();
            if(!$("#search_mentor_form").valid()) {
                var p_error = $("#search_mentor_form").find("p.has-error");
                $("#search_mentor_form").append(p_error.clone());
                p_error.remove();
                return
            }

            $.ajax('/search/search_mentor_basic', {
                type: 'GET',
                dataType: 'script',
                data:  $("#search_mentor_form").serializeArray(),
                beforeSend: function (xhr) {
                    $.loader.open({imgUrl: "<%= asset_path('assets/template/ajaxloader/images/loading16x16.gif') %>"});
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    $.loader.close(true);
                    console.log("AJAX Error: " + textStatus);
                },
                success: function (data, textStatus, jqXHR) {
                    $.loader.close(true);
                }
            });
        });

        $("#btnSearchMentorAdvance").click(function(e){
            e.preventDefault();

            $("#form_add_specialty").hide();
            $("#btn_add_specialty").show();
            $("#form_add_job_title").hide();
            $("#btn_add_job_title").show();
            $("#form_add_company_name").hide();
            $("#btn_add_company_name").show();
            $("#form_add_school_name").hide();
            $("#btn_add_school_name").show();

            $("p.has-error").remove();
            $(".has-error").removeClass("has-error");

            if(!$("#search_mentor_advance").valid()){
                return
            }

            $.ajax('/search/search_mentor_advance', {
                type: 'GET',
                dataType: 'script',
                data:  $("#search_mentor_advance").serializeArray(),
                beforeSend: function (xhr) {
                    $.loader.open({imgUrl: "<%= asset_path('assets/template/ajaxloader/images/loading16x16.gif') %>"});
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    $.loader.close(true);
                    console.log("AJAX Error: " + textStatus);
                },
                success: function (data, textStatus, jqXHR) {
                    $.loader.close(true);
                    $("#Search_mentor_Modal").modal("hide");
                }
            });
        });
        $("#btnResetSearchMentorAdvance").click(function(e){
            e.preventDefault();

//          reset form

            $("p.has-error").remove();
            $(".has-error").removeClass("has-error");

            $("#first_name").val('');
            $("#last_name").val('');
            $("#country").val('');

            $("#jobTitleList").find("li").remove();
            $("#job_title").val('');
            $("#specialtyList").find("li").remove();
            $("#specialty").val('');
            $("#companyList").find("li").remove();
            $("#company_name").val('');
            $("#schoolList").find("li").remove();
            $("#school_name").val('');


            $("#form_add_specialty").hide();
            $("#btn_add_specialty").show();
            $("#form_add_job_title").hide();
            $("#btn_add_job_title").show();
            $("#form_add_company_name").hide();
            $("#btn_add_company_name").show();
            $("#form_add_school_name").hide();
            $("#btn_add_school_name").show();


        });


    });

</script>