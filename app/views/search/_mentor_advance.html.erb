<%= form_tag search_search_mentor_advance_path,id: 'search_mentor_advance', class: 'form-horizontal' do %>
<div class="row" >
  <div class="col-md-4">
    <div class="innerAll">
        <div class="row">
            <label for="first_name"><%= t('users.lb_first_name') %></label>
            <%= text_field_tag :first_name, params[:first_name], placeholder: t('users.lb_first_name'), class: "form-control", maxlength:50 %>
        </div>

        <div class="row">
            <label for="last_name"><%= t('users.lb_last_name') %></label>
            <%= text_field_tag :last_name, params[:last_name], placeholder: t('users.lb_last_name'), class: "form-control", maxlength:50 %>
        </div>

        <div class="row">
            <label for="country"><%= t('users.lb_country') %></label>
            <%= select_tag :country, options_for_select(Country.all.order('name asc').collect {|u| [u.name, u.id]}),class: "form-control",:prompt => t('amazon.title_select')%>
        </div>
      </div>
  </div>

  <div class="col-md-8">
    <div class="innerAll">
        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#accordion_history">
              <h4 class="border-bottom"><%=t('search_mentor.title_job_title')%></h4>
            </a>
          </div>
          <div id="accordion_history" class="accordion-body collapse in">
            <div class="innerAll">
              <div class="accordion-inner">
                <div>
                    <a id="btn_add_job_title" ><i class="fa fa-plus" ></i>&nbsp;<%= t('search_mentor.title_add_job_title')%></a>
                </div>
                <div>
                  <div id='form_add_job_title'  style="display:none;" >
                      <div class="input-group">
                        <%= text_field_tag :history_job, params[:history_job], placeholder: t('search_mentor.placeholder_job_title'), class: "form-control", maxlength:50%>
                        <div class="input-group-btn"><button id="btnAddJobToList" class="btn btn-primary rounded-none"><i class="fa fa-plus"></i></button></div>
                      </div>
                  </div>
                </div>
                <div id="div_History_Job" style="max-height: 150px; overflow-y: auto; overflow-x: hidden; margin-top: 10px">
                  <ul id="jobTitleList" class="list-group">
                  </ul>
                </div>
              </div>
            </div>
          </div>
          </div>
    <div class="accordion-group">
      <div class="accordion-heading">
        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#accordion_specialty"  style="color:#913228">
          <h4 class="border-bottom"><%=t('search_mentor.title_specialty')%></h4>
      </a>
      </div>
      <div id="accordion_specialty" class="accordion-body collapse in" >
        <div class="innerAll">
          <div class="accordion-inner">
            <div>
              <a id="btn_add_specialty" ><i class="fa fa-plus" ></i>&nbsp;<%= t('search_mentor.title_add_specialty')%></a>
            </div>
            <div>
              <div id='form_add_specialty'  style="display:none;" >
                <div class="input-group">
                  <%= text_field_tag :specialty, params[:specialty], placeholder: t('search_mentor.placeholder_specialty'), class: "form-control", maxlength:50%>
                  <div class="input-group-btn"><button id="btnAddSpecialtyToList" class="btn btn-primary rounded-none"><i class="fa fa-plus"></i></button></div>
                </div>
              </div>
            </div>
            <div id="div_specialty" style="max-height: 150px; overflow-y: auto; overflow-x: hidden; margin-top: 10px">
              <ul id="specialtyList" class="list-group">
              </ul>
            </div>
          </div>
          </div>
      </div>
    </div>
  </div>
  </div>
</div>
<% end %>
<script>
    $(document).ready(function () {
        $("#search_mentor_advance").validate({
            onfocusout: false,
            onkeyup: false,
            rules: {
                "first_name": {
                    maxlength: {
                        param: 50,
                        depends:function(){
                            var text = $.trim($(this).val());
                            text=text.replace(/\s+/g, ' ');
                            $(this).val(text);
                            return true;
                        }
                    }
                },
                "last_name": {
                    maxlength: {
                        param: 50,
                        depends: function () {
                            var text = $.trim($(this).val());
                            text = text.replace(/\s+/g, ' ');
                            $(this).val(text);
                            return true;
                        }
                    }
                },
                "history_job": {
                    required: {
                        depends: function () {
                            var text = $.trim($(this).val());
                            text = text.replace(/\s+/g, ' ');
                            $(this).val(text);
                            return true;
                        }
                    },
                    maxlength: 50
                },
                "specialty": {
                    required: {
                        depends: function () {
                            var text = $.trim($(this).val());
                            text = text.replace(/\s+/g, ' ');
                            $(this).val(text);
                            return true;
                        }
                    },
                    maxlength: 50
                }},
                messages: {
                    "first_name": {
                        maxlength: I18n.t("js.validate.msg_maxlength")
                    },
                    "last_name": {
                        maxlength: I18n.t("js.validate.msg_maxlength")
                    },
                    "history_job": {
                        required: I18n.t("js.validate.msg_required"),
                        maxlength: I18n.t("js.validate.msg_maxlength")
                    },
                    "specialty": {
                        required: I18n.t("js.validate.msg_required"),
                        maxlength: I18n.t("js.validate.msg_maxlength")
                    }
                },
                errorPlacement: function (error, element) {
                    error.insertAfter(element);
                },
                invalidHandler: function (form, validator) {
                    $('#div_msg_error').text('');

                    var errors = validator.numberOfInvalids();
                    if (errors) {
                        validator.errorList[0].element.focus();
                    }
                }

        });

        $("#history_job").keypress(function( event ) {
            if (event.which == 13) {
                event.preventDefault();
                $("#btnAddJobToList").click();
            }
        });

        $("#specialty").keypress(function( event ) {
            if (event.which == 13) {
                event.preventDefault();
                $("#btnAddSpecialtyToList").click();
            }
        });

        // add new history job
        $("#btn_add_job_title").click(function(e){
            e.preventDefault();
            $(this).hide();
            $("#form_add_job_title").show();
            $("#form_add_job_title").find("p.has-error").remove();

            $("#history_job").val('');
            $("#history_job").focus();
        });

        $("#btnAddJobToList").click(function(e){
            e.preventDefault();
            $("#form_add_job_title").find("p.has-error").remove();

            if (!$("#history_job").valid()) {
                // replace error
                var p_error = $("#form_add_job_title").find("p.has-error");
                $("#form_add_job_title").append(p_error.clone());
                p_error.remove();
                return
            }

            //check duplicate
            var job_title = $("#history_job").val().toLowerCase();
            var errorDuplicate = "<%= I18n.t('search_mentor.msg_error_duplicate_job_title')%>";
            var existed = false;
            $('#jobTitleList').find('.form-control').each(function(){
                if ($(this).val().toLowerCase() == job_title) {
                    existed = true;
                    return true;
                }
            });

            if (existed) {
                $("#form_add_job_title").append("<p class=\"has-error\">" + errorDuplicate +"</p>");
                return;
            }

            if ($("#history_job").val() != '') {
                //add job to list
                add_history_job($("#history_job").val());
                $("#form_add_job_title").hide();
                $("#btn_add_job_title").show();
            }
        });


        function add_history_job(name){
            $("#jobTitleList").append("<li class=\"list-group-item\"><div class=\"row\"><div class='col-xs-10'><label style='word-wrap: break-word'>"+name+"</label><input class=\"form-control\" maxlength=\"200\" name=\"history_jobs[]\" style='display:none' value='"+name+"' type=\"text\"></div><div class='col-xs-2'><a class='btn_remove_job'> <i class=\"fa fa-times fa-fw pull-right\" ></i></a></div></div></li>");
            $(".btn_remove_job").click(function(e){
                e.preventDefault();
                $(this).closest(".list-group-item").remove();
            });
        }

        // add specialty

        $("#btn_add_specialty").click(function(e){
            e.preventDefault();
            $(this).hide();
            $("#form_add_specialty").show();
            $("#form_add_specialty").find("p.has-error").remove();

            $("#specialty").val('');
            $("#specialty").focus();
        });

        $("#btnAddSpecialtyToList").click(function(e){
            e.preventDefault();
            $("#form_add_specialty").find("p.has-error").remove();

            if (!$("#specialty").valid()) {
                // replace error
                var p_error = $("#form_add_specialty").find("p.has-error");
                $("#form_add_specialty").append(p_error.clone());
                p_error.remove();
                return
            }

            //check duplicate
            var specialty = $("#specialty").val().toLowerCase();
            var errorDuplicate = "<%= I18n.t('search_mentor.msg_error_duplicate_specialty')%>";
            var existed = false;
            $('#specialtyList').find('.form-control').each(function(){
                if ($(this).val().toLowerCase() == specialty) {
                    existed = true;
                    return true;
                }
            });

            if (existed) {
                $("#form_add_specialty").append("<p class=\"has-error\">" + errorDuplicate +"</p>");
                return;
            }

            //add job to list
            if ($("#specialty").val() != '') {
                add_specialty($("#specialty").val());
                $("#form_add_specialty").hide();
                $("#btn_add_specialty").show();
            }
        });

        function add_specialty(name){
            $("#specialtyList").append("<li class=\"list-group-item\"><div class=\"row\"><div class='col-xs-10'><label style='word-wrap: break-word'>"+name+"</label><input class=\"form-control\" maxlength=\"200\" name=\"specialties[]\" style='display:none' value='"+name+"' type=\"text\"></div><div class='col-xs-2'><a class='btn_remove_specialty'> <i class=\"fa fa-times fa-fw pull-right\" ></i></a></div></div></li>");
            $(".btn_remove_specialty").click(function(e){
                e.preventDefault();
                $(this).closest(".list-group-item").remove();
            });
        }
    });
</script>